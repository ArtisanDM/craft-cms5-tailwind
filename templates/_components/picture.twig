{#
   Picture
   Generate a picture element with an srcset and lazy load

   @type {include}
   @param {string/object} image
   @param {string} transform
   @param {string} pictureClass
   @param {string} imgClass
   @param {string} svgClass
   @param {bool} svgConvert
   @param {string} alt
   @param {bool} lazy

#}

{% set lazy = lazy ?? false %}
{% set transform = transform ?? [] %}
{% set webp = craft.imager.serverSupportsWebp() and craft.app.config.env != 'production' ? true : false %}

{% if image['extension'] is defined and image.extension == 'svg' %}

   {% if svgConvert is defined %}

      {% set svgClass = svgClass ?? 'fill-current' %}
      {{ svg(image, class=svgClass) }}

   {% else %}

      <img 
         src="{{ image.url }}" 
         alt="{{ alt ?? image.title }}"
         {% if imgClass is defined %} class="{{ imgClass }}"{% endif %}
      >
      
   {% endif %}

{% else %}

   {% set pictureTransform = craft.imager.transformImage(
      image,
      transform
   ) %}

   {% if webp %}
      {% set pictureTransformWebp = craft.imager.transformImage(
         image,
         transform,
         {
            format: 'webp'
         }
      ) %}
   {% endif %}

   {% if
      pictureTransform|length or
      pictureTransformWebp is defined and
      pictureTransformWebp|length
   %}

      <picture{% if pictureClass is defined %} class="{{ pictureClass }}"{% endif %}>
         {% if lazy %}
            {% if webp %}
               <source
                  data-srcset="{{ craft.imager.srcset(pictureTransformWebp) }}"
                  data-sizes="100vw"
                  type="image/webp"
               >
            {% endif %}
            <img
               src="{{ craft.imager.placeholder({ width: pictureTransform.width, height: pictureTransform.height }) }}"
               data-src="{{ webp ? pictureTransformWebp|last : pictureTransform|last }}"
               data-srcset="{{ craft.imager.srcset(pictureTransform) }}"
               data-sizes="100vw"
               alt="{{ alt ?? image.title }}"
               class="js-lazy-load{% if imgClass is defined %} {{ imgClass }}{% endif %}"
            >
         {% else %}
            {% if webp %}
               <source
                  srcset="{{ craft.imager.srcset(pictureTransformWebp) }}"
                  sizes="100vw"
                  type="image/webp"
               >
            {% endif %}
            <img
               src="{{ webp ? pictureTransformWebp|last : pictureTransform|last }}"
               srcset="{{ craft.imager.srcset(pictureTransform) }}"
               sizes="100vw"
               alt="{{ alt ?? image.title }}"
               {% if imgClass is defined %} class="{{ imgClass }}"{% endif %}
            >
         {% endif %}
      </picture>

   {% endif %}

{% endif %}
