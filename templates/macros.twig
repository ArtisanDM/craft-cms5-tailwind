{# ------- Date ------- #}

{% macro date(date, relative) %}

  {% set dateFormat = 'jS F Y' %}

  {% if relative and now|date('U') <= date|date_modify('+14 day')|date('U') %}
    {{ date|date('U') }}
  {% else %}
    {{ date|date(dateFormat) }}
  {% endif %}

{% endmacro %}

{# --- Picture --- #}

{% macro picture(attributes) %}

   {% set defaults = {
      image: null,
      alt: null,
      lazy: true,
      sizes: [
         { width: 1920 },
         { width: 1400 },
         { width: 768 },
         { width: 360 }
      ],
      transforms: {
         mode: 'crop',
         allowUpscale: true
      }
   } %}

   {% set attributes = defaults|merge(attributes) %}

   {% set picture = craft.imager.transformImage(
      attributes.image,
      attributes.transforms
   ) %}

   {% set pictureTransform = craft.imager.transformImage(
      picture,
      attributes.sizes
   ) %}

   {% if craft.imager.serverSupportsWebp() %}
      {% set pictureTransformWebp = craft.imager.transformImage(
         picture,
         attributes.sizes,
         {
            format: 'webp'
         }
      ) %}
   {% endif %}

   {% if
      pictureTransform|length or
      pictureTransformWebp is defined and
      pictureTransformWebp|length
   %}

      <picture>
         {% if attributes.lazy %}
            {% if craft.imager.serverSupportsWebp() %}
               <source
                  data-srcset="{{ craft.imager.srcset(pictureTransformWebp) }}"
                  data-sizes="100vw"
                  type="image/webp"
               >
            {% endif %}
            <img
               src="{{ craft.imager.placeholder({ width: picture.width, height: picture.height }) }}"
               data-src="{{ craft.imager.serverSupportsWebp() ? pictureTransformWebp|last.url : pictureTransform|last.url }}"
               data-srcset="{{ craft.imager.srcset(pictureTransform) }}"
               data-sizes="100vw"
               alt="{{ attributes.alt ?? attributes.image.title }}"
               class="js-lazy-load"
            >
         {% else %}
            {% if craft.imager.serverSupportsWebp() %}
               <source
                  srcset="{{ craft.imager.srcset(pictureTransformWebp) }}"
                  sizes="100vw"
                  type="image/webp"
               >
            {% endif %}
            <img
               src="{{ craft.imager.serverSupportsWebp() ? pictureTransformWebp|last.url : pictureTransform|last.url }}"
               srcset="{{ craft.imager.srcset(pictureTransform) }}"
               sizes="100vw"
               alt="{{ attributes.alt ?? attributes.image.title }}"
            >
         {% endif %}
      </picture>

   {% endif %}

{% endmacro %}
